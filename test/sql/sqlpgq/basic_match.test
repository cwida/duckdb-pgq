# name: test/sql/sqlpgq/basic_match.test
# group: [sqlpgq]

statement ok
pragma enable_verification

statement ok
CREATE TABLE Student(id BIGINT, name VARCHAR);

statement ok
CREATE TABLE know(src BIGINT, dst BIGINT, createDate BIGINT);

statement ok
CREATE TABLE School(school_name VARCHAR, school_id BIGINT, school_kind BIGINT);

statement ok
INSERT INTO Student VALUES (0, 'Daniel'), (1, 'Tavneet'), (2, 'Gabor'), (3, 'Peter'), (4, 'David');

statement ok
INSERT INTO know VALUES (0,1, 10), (0,2, 11), (0,3, 12), (3,0, 13), (1,2, 14), (1,3, 15), (2,3, 16), (4,3, 17);

# vertex table with alias
#    School PROPERTIES ( school_id, school_name) LABEL School

statement ok
CREATE PROPERTY GRAPH pg
VERTEX TABLES (
    Student PROPERTIES ( id, name ) LABEL Person
    )
EDGE TABLES (
    know    SOURCE KEY ( src ) REFERENCES Student ( id )
            DESTINATION KEY ( dst ) REFERENCES Student ( id )
            PROPERTIES ( createDate ) LABEL Knows
    );

query II
SELECT study.a_id, study.name
FROM GRAPH_TABLE (pg,
    MATCH
    (a:Person WHERE a.id = 0)
    COLUMNS (a.id as a_id, a.name)
    ) study
----
0	Daniel


query I
SELECT study.id
FROM GRAPH_TABLE (pg,
    MATCH
    (a:Person)
    COLUMNS (a.id)
    ) study
----
0
1
2
3
4

query II
SELECT study.a_id, study.name
FROM GRAPH_TABLE (pg,
    MATCH
    (a:Person)
    WHERE a.id = 0
    COLUMNS (a.id as a_id, a.name)
    ) study
----
0	Daniel


query II
SELECT study.a_name, study.b_name
FROM GRAPH_TABLE (pg,
    MATCH
    (a:Person)-[k:Knows]->(b:Person)
    WHERE a.name = 'Daniel'
    COLUMNS (a.name as a_name, b.name as b_name)
    ) study;
----
Daniel	Tavneet
Daniel	Gabor
Daniel	Peter

#query II
#SELECT study.a_name, study.b_name
#FROM (SELECT a.name as a_name, b.name as b_name
#       FROM Student a, Know k, Student b
#       WHERE (a.id = k.src and b.id = k.dst) or (a.id = k.dst and b.id = k.src)
#       )
#       study
#----
#Daniel	Gabor

query II
SELECT study.a_name, study.b_name
FROM GRAPH_TABLE (pg,
    MATCH
    (a:Person)-[k:Knows]->(b:Person)
    WHERE a.name = 'Daniel' and b.name = 'Gabor'
    COLUMNS (a.name as a_name, b.name as b_name)
    ) study;
----
Daniel	Gabor

query II
SELECT study.a_name, study.b_name
FROM GRAPH_TABLE (pg,
    MATCH
    (a:Person)<-[k:Knows]-(b:Person)
    WHERE a.name = 'Peter'
    COLUMNS (a.name as a_name, b.name as b_name)
    ) study;
----
Peter	Daniel
Peter	Tavneet
Peter	Gabor
Peter	David

query II
SELECT study.a_name, study.b_name
FROM GRAPH_TABLE (pg,
    MATCH
    (a:Person)-[k:Knows]-(b:Person)
    WHERE a.name = 'Peter'
    COLUMNS (a.name as a_name, b.name as b_name)
    ) study;
----
Peter	Daniel
Peter	Tavneet
Peter	Gabor
Peter	David

query II
SELECT study.a_name, study.b_name
FROM GRAPH_TABLE (pg,
    MATCH
    (a:Person)<-[k:Knows]->(b:Person)
    WHERE a.name = 'Peter'
    COLUMNS (a.name as a_name, b.name as b_name)
    ) study;
----
Peter	Daniel


